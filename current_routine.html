<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">  
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="authors" content="Michelle Gao and Henna Panjshiri">
    <title>Clara: Current Routine</title>
    <link rel="stylesheet" href="styles/style.css?v=5">
</head>

<body>
    <header>
        <nav class="navbar">
            <div class="nav-left">
                <a href="daily_log.php" class="home-icon">üè†</a>
                <ul>
                    <li><a href="daily_log.php">Log Today</a></li>
                    <li><a href="dashboard.php">Dashboard</a></li>
                    <li><a href="current_routine.html" class="active">Current Routine</a></li>
                </ul>
            </div>

            <div class="nav-right">
                <span>Hello, [Name!]</span>
                <a href="index.php" class="profile-icon">üë§</a>
            </div>
        </nav>
    </header>

    <!--overall products container-->
    <div class="products-container">

        <div class="left-products-container">
            
            <!--daytime nighttime icons-->
            <img class="product-icons theme-icon active" src="images/sun.png" id="sun-icon" alt="Sun Icon" style="width:40px">
            <img class="product-icons theme-icon" src="images/moon.png" id="moon-icon" alt="Moon Icon" style="width:37px">
            <hr style="position: relative; top: 20px; height: 3px; color: #243e36; background-color: #243e36">
            
            <!--sub container for left side-->
            <div class="left-products-inner">
                
                <!--edit text and icons-->
                <img class="product-icons" src="images/pencil.png" alt="Edit Icon" style="width:30px; display: inline-block">
                <p class="product-icons" style="display: inline-block; font-size:22px;">Edit</p>

                <!--skincare products display-->
                <div class="products-list">
                    <div class="product-item">
                        <!--skincare products placeholders-->
                        <img class="product-rect" src="images/lotion.png" alt="Lotion bottle" style="width:200px">
                        <label for="lotion-check">Lotion</label>
                        <input type="checkbox" id="lotion-check" class="product-checkbox">
                    </div>

                    <div class="product-item">
                        <!--skincare products placeholders-->
                        <img class="product-rect" src="images/cleanser.png" alt="Facial Cleanser" style="width:200px">
                        <label for="cleanser-check">Cleanser</label>
                        <input type="checkbox" id="cleanser-check" class="product-checkbox">
                    </div>
                </div>
            </div>
        </div>

        <div class="right-products-container">
            <!--sub container for right side side-->
            <div class="right-products-inner">
                <div class="product-search-bar">
                    <input type="text" id="myInput" onkeyup="searchFunction()" placeholder="üîçFind a product...">
                    <ul id="productsUL">
                        <li class="product-row">
                            <span>Cleanser</span>
                            <img src="images/add.png" alt="Add Icon" class="add-icon" data-product="Cleanser">
                        </li>
                        <hr>
                        <li class="product-row">
                            <span>Toner</span>
                            <img src="images/add.png" alt="Add Icon" class="add-icon" data-product="Toner">
                        </li>
                        <hr>
                        <li class="product-row">
                            <span>Serum</span>
                            <img src="images/add.png" alt="Add Icon" class="add-icon" data-product="Serum">
                        </li>
                        <hr>
                        <li class="product-row">
                            <span>Moisturizer</span>
                            <img src="images/add.png" alt="Add Icon" class="add-icon" data-product="Moisturizer">
                        </li>
                        <hr>
                        <li class="product-row">
                            <span>Sunscreen</span>
                            <img src="images/add.png" alt="Add Icon" class="add-icon" data-product="Sunscreen">
                        </li>
                        <hr>
                        <li class="product-row">
                            <span>Spot treatment</span>
                            <img src="images/add.png" alt="Add Icon" class="add-icon" data-product="Spot treatment">
                        </li>
                        <hr>
                        <li class="product-row">
                            <span>Face mask</span>
                            <img src="images/add.png" alt="Add Icon" class="add-icon" data-product="Face mask">
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
    // toggle sun and moon buttons
    document.addEventListener("DOMContentLoaded", () => {
        const sun  = document.getElementById("sun-icon");
        const moon = document.getElementById("moon-icon");

        if (!sun || !moon) {
            console.log("Sun or moon icons not found.");
            return;
        }

        // START STATE
        sun.classList.add("active");
        moon.classList.remove("active");

        sun.onclick = () => {
            sun.classList.add("active");
            moon.classList.remove("active");
        };

        moon.onclick = () => {
            moon.classList.add("active");
            sun.classList.remove("active");
        };
    });

    function searchFunction() {
        let input = document.getElementById('myInput');
        let filter = input.value.toUpperCase();
        let ul = document.getElementById('productsUL');
        let li = ul.getElementsByTagName('li');

        // loop through list items, and hide those who don't match search query
        for (i = 0; i < li.length; i++) {
            txtSpan = li[i].getElementsByTagName("span")[0];
            txtValue = txtSpan.textContent || txtSpan.innerText;
            
            if (txtValue.toUpperCase().indexOf(filter) > -1) {
                li[i].style.display = "";
                li[i].classList.add("highlight");
            } else {
                li[i].style.display = "none";
                li[i].classList.remove("highlight");
            }
        }
    }

    // document.addEventListener("DOMContentLoaded", () => {
    //     const productImages = {
    //         "Cleanser": "images/cleanser.png",
    //         "Lotion": "images/lotion.png",
    //         "Toner": "images/toner.png",
    //         "Face mask": "images/mask.png",
    //         "Spot Treatment": "images/treatment.png"
    //     };

    //     const rightList = document.getElementById("productsUL");
    //     const leftContainer = document.querySelector(".products-list");

    //     rightList.addEventListener("click", function(e) {
    //         if (e.target.classList.contains("add-icon")) {

    //             const productName = e.target.dataset.product;

    //             // remove from right list
    //             e.target.parentElement.remove();

    //             // create new product block on the left side
    //             const newItem = document.createElement("div");
    //             newItem.classList.add("product-item");

    //             newItem.innerHTML = `
    //                 <img class="product-rect" src="images/${productName}.png" alt="${productName}" style="width:200px">
    //                 <label>${productName}</label>
    //                 <input type="checkbox" class="product-checkbox">
    //             `;

    //             leftContainer.appendChild(newItem);
    //         }
    //     });

    // });

    $(document).ready(function () {

        // ---------------------------------------------
        // 1. JAVASCRIPT OBJECT (Requirement #1)
        // ---------------------------------------------
        let routineManager = {
            addedProducts: [],    // store products added to left panel

            addProduct(product) {
                this.addedProducts.push(product);
            },

            removeProduct(name) {
                this.addedProducts = this.addedProducts.filter(p => p.name !== name);
            }
        };

        // ---------------------------------------------
        // 2. AJAX LOAD PRODUCTS FROM PHP (Requirement #3)
        // ---------------------------------------------
        $.ajax({
            url: "controller/get_products.php",
            method: "GET",
            dataType: "json",
            success: function(products) {

                // Populate the right-side product list
                let ul = $("#productsUL");
                ul.empty();

                products.forEach(product => {
                    ul.append(`
                        <li class="product-row">
                            <span>${product.name}</span>
                            <img src="images/plus.png" 
                                class="add-icon" 
                                data-product='${JSON.stringify(product)}'>
                        </li>
                    `);
                });
            }
        });

        // ---------------------------------------------
        // 3. jQuery EVENT HANDLER (Requirement #2)
        // Clicking the "+" button adds the product to left side
        // ---------------------------------------------
        $("#productsUL").on("click", ".add-icon", function () {

            let product = JSON.parse($(this).attr("data-product"));

            // Update JavaScript object
            routineManager.addProduct(product);

            // Remove from right-side list
            $(this).closest("li").remove();

            // Add to the left-side container
            $(".products-list").append(`
                <div class="product-item">
                    <img class="product-rect" src="${product.image}" alt="${product.name}" style="width:200px">
                    <label>${product.name}</label>
                    <input type="checkbox" class="product-checkbox">
                </div>
            `);
        });

        // ---------------------------------------------
        // 4. SEARCH FUNCTION (still works, optional jQuery)
        // ---------------------------------------------
        window.searchFunction = function() {
            let filter = $("#myInput").val().toUpperCase();

            $("#productsUL li").each(function () {
                let txtValue = $(this).find("span").text().toUpperCase();

                if (txtValue.indexOf(filter) > -1) {
                    $(this).show().addClass("highlight");
                } else {
                    $(this).hide().removeClass("highlight");
                }
            });
        };

    });
    </script>
</body>
</html>